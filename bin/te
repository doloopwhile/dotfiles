#!/bin/bash
usage() {
  echo 'usage: COMMAND | te [-e EXT]'
}

EXT='txt'
args=()
while [ $# -gt 0 ]; do
  case "$1" in
    '-e' )
      shift
      EXT="$1"
    ;;
    '-h' )
      usage
      exit
    ;;
    * )
      usage >&2
      exit 1
    ;;
  esac
  shift
done

cat - \
  | sed -e "s/\e\\[[0-9;]*m//g" \
  | col -b -p \
  | sed -e 's/\t/    /g' \
  | ~/dotfiles/bin/save-tempfile --abort-if-empty --prefix='.tmp.' --suffix=".${EXT}" -c code
